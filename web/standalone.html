<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RL Interactive Studio</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        // Simple icons as SVG components
        const Brain = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M12 4.5a2.5 2.5 0 0 0-4.96-.46 2.5 2.5 0 0 0-1.98 3 2.5 2.5 0 0 0-1.32 4.24 3 3 0 0 0 .34 5.58 2.5 2.5 0 0 0 2.96 3.08 2.5 2.5 0 0 0 4.91.05L12 20V4.5ZM16 8V5c0-1.1.9-2 2-2"/>
            </svg>
        );

        const RotateCcw = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
            </svg>
        );

        const Zap = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
            </svg>
        );

        const Settings = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v6m0 6v6m5.2-13.8-4.2 4.2m-1.4 1.4L7.4 7.4M23 12h-6m-6 0H5m13.8 5.2-4.2-4.2m-1.4-1.4-4.2 4.2"/>
            </svg>
        );

        const BarChart = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" x2="12" y1="20" y2="10"/>
                <line x1="18" x2="18" y1="20" y2="4"/>
                <line x1="6" x2="6" y1="20" y2="16"/>
            </svg>
        );

        const Info = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 16v-4m0-4h.01"/>
            </svg>
        );

        // RL Agent Class
        class RLAgent {
            constructor(alpha = 0.5, gamma = 0.9, epsilon = 0.1) {
                this.qTable = {};
                this.alpha = alpha;
                this.gamma = gamma;
                this.epsilon = epsilon;
            }

            getQ(state, action) {
                const key = `${state}_${action}`;
                return this.qTable[key] || 0.0;
            }

            setQ(state, action, value) {
                const key = `${state}_${action}`;
                this.qTable[key] = value;
            }

            getBestAction(state, availableActions) {
                if (!availableActions || availableActions.length === 0) return null;
                let bestValue = -Infinity;
                let bestActions = [];
                
                availableActions.forEach(action => {
                    const val = this.getQ(state, action);
                    if (val > bestValue) {
                        bestValue = val;
                        bestActions = [action];
                    } else if (val === bestValue) {
                        bestActions.push(action);
                    }
                });

                return bestActions[Math.floor(Math.random() * bestActions.length)];
            }

            chooseAction(state, availableActions) {
                if (Math.random() < this.epsilon) {
                    return availableActions[Math.floor(Math.random() * availableActions.length)];
                }
                return this.getBestAction(state, availableActions);
            }

            learn(state, action, reward, nextState, nextAvailableActions) {
                const currentQ = this.getQ(state, action);
                const maxNextQ = nextAvailableActions && nextAvailableActions.length > 0
                    ? Math.max(...nextAvailableActions.map(a => this.getQ(nextState, a)))
                    : 0;
                const target = reward + this.gamma * maxNextQ;
                const newQ = currentQ + this.alpha * (target - currentQ);
                this.setQ(state, action, newQ);
            }
        }

        // Tic-Tac-Toe Game Logic
        const TTT_WIN_COMBOS = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8],
            [0, 3, 6], [1, 4, 7], [2, 5, 8],
            [0, 4, 8], [2, 4, 6]
        ];

        const checkWinner = (board) => {
            for (let combo of TTT_WIN_COMBOS) {
                const [a, b, c] = combo;
                if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                    return board[a];
                }
            }
            if (!board.includes(null)) return 'DRAW';
            return null;
        };

        // Main Component
        function TicTacToe() {
            const [board, setBoard] = useState(Array(9).fill(null));
            const [isXNext, setIsXNext] = useState(true);
            const [gameStatus, setGameStatus] = useState('playing');
            const [winner, setWinner] = useState(null);
            const [agent] = useState(() => new RLAgent(0.5, 0.9, 0.15));
            const [trainingEpisodes, setTrainingEpisodes] = useState(0);
            const [showQValues, setShowQValues] = useState(false);
            const [epsilon, setEpsilon] = useState(0.15);
            const [learningRate, setLearningRate] = useState(0.5);
            const [stats, setStats] = useState({ wins: 0, losses: 0, draws: 0, totalGames: 0 });
            const [isTraining, setIsTraining] = useState(false);

            useEffect(() => {
                agent.epsilon = epsilon;
                agent.alpha = learningRate;
            }, [epsilon, learningRate]);

            const getBoardState = (b) => b.map(c => c === null ? '0' : (c === 'X' ? '1' : '2')).join('');
            const getAvailableMoves = (b) => b.map((val, idx) => val === null ? idx : null).filter(val => val !== null);

            const handleCellClick = (index) => {
                if (board[index] || gameStatus !== 'playing' || !isXNext) return;
                const newBoard = [...board];
                newBoard[index] = 'X';
                setBoard(newBoard);
                
                const result = checkWinner(newBoard);
                if (result) {
                    handleGameEnd(result);
                } else {
                    setIsXNext(false);
                }
            };

            useEffect(() => {
                if (!isXNext && gameStatus === 'playing' && !isTraining) {
                    const timer = setTimeout(makeBotMove, 600);
                    return () => clearTimeout(timer);
                }
            }, [isXNext, gameStatus, isTraining]);

            const makeBotMove = useCallback(() => {
                const currentStateStr = getBoardState(board);
                const available = getAvailableMoves(board);
                if (available.length === 0) return;

                const action = agent.chooseAction(currentStateStr, available);
                const newBoard = [...board];
                newBoard[action] = 'O';
                setBoard(newBoard);

                const result = checkWinner(newBoard);
                if (result) {
                    let reward = result === 'O' ? 10 : (result === 'X' ? -10 : 5);
                    agent.learn(currentStateStr, action, reward, getBoardState(newBoard), []);
                    handleGameEnd(result);
                } else {
                    agent.learn(currentStateStr, action, -0.1, getBoardState(newBoard), getAvailableMoves(newBoard));
                    setIsXNext(true);
                }
            }, [board]);

            const handleGameEnd = (result) => {
                setGameStatus('finished');
                setWinner(result);
                const newStats = { ...stats };
                if (result === 'X') newStats.wins++;
                else if (result === 'O') newStats.losses++;
                else newStats.draws++;
                newStats.totalGames++;
                setStats(newStats);
            };

            const resetGame = () => {
                setBoard(Array(9).fill(null));
                setGameStatus('playing');
                setWinner(null);
                setIsXNext(true);
            };

            const trainAgent = async () => {
                setIsTraining(true);
                
                for (let i = 0; i < 1000; i++) {
                    let b = Array(9).fill(null);
                    let turn = Math.random() > 0.5 ? 'X' : 'O';
                    
                    while(true) {
                        const available = getAvailableMoves(b);
                        if (available.length === 0) break;

                        const stateStr = getBoardState(b);
                        const action = turn === 'O' 
                            ? agent.chooseAction(stateStr, available)
                            : available[Math.floor(Math.random() * available.length)];

                        b[action] = turn;
                        const res = checkWinner(b);
                        
                        if (turn === 'O') {
                            let reward = res === 'O' ? 10 : (res === 'X' ? -10 : (res === 'DRAW' ? 5 : -0.1));
                            agent.learn(stateStr, action, reward, getBoardState(b), getAvailableMoves(b));
                        }
                        
                        if (res) break;
                        turn = turn === 'X' ? 'O' : 'X';
                    }
                }

                setTrainingEpisodes(e => e + 1000);
                setIsTraining(false);
            };

            const winRate = stats.totalGames > 0 ? (stats.wins / stats.totalGames * 100).toFixed(1) : 0;

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 p-8">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="bg-white/80 backdrop-blur-xl rounded-2xl shadow-xl p-6 mb-8 border border-slate-200">
                            <div className="flex items-center gap-4">
                                <div className="w-12 h-12 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center text-white shadow-lg">
                                    <Brain />
                                </div>
                                <div>
                                    <h1 className="text-3xl font-black bg-clip-text text-transparent bg-gradient-to-r from-blue-700 to-indigo-700">
                                        RL Interactive Studio
                                    </h1>
                                    <p className="text-sm text-slate-600 font-semibold">Learn Reinforcement Learning by Playing</p>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Game Board */}
                            <div className="lg:col-span-2 bg-white rounded-2xl shadow-xl p-8 border border-slate-200">
                                <h2 className="text-2xl font-bold text-slate-800 mb-6 text-center">Tic-Tac-Toe</h2>
                                
                                <div className="relative max-w-md mx-auto">
                                    <div className="grid grid-cols-3 gap-3 p-4 bg-slate-50 rounded-xl">
                                        {board.map((cell, idx) => {
                                            const stateStr = getBoardState(board);
                                            const qVal = agent.getQ(stateStr, idx);
                                            let bgClass = "bg-white hover:bg-slate-100";
                                            if (cell === 'X') bgClass = "bg-blue-100 text-blue-700";
                                            if (cell === 'O') bgClass = "bg-rose-100 text-rose-700";
                                            
                                            return (
                                                <button 
                                                    key={idx}
                                                    onClick={() => handleCellClick(idx)}
                                                    disabled={cell !== null || !isXNext || gameStatus !== 'playing'}
                                                    className={`relative w-24 h-24 rounded-xl flex items-center justify-center text-5xl font-black transition-all duration-200 shadow-md hover:shadow-lg hover:scale-105 disabled:hover:scale-100 ${bgClass}`}
                                                >
                                                    {cell}
                                                    {showQValues && !cell && qVal !== 0 && (
                                                        <span className="absolute top-1 right-1 text-[9px] text-slate-500 font-mono">
                                                            {qVal.toFixed(1)}
                                                        </span>
                                                    )}
                                                </button>
                                            );
                                        })}
                                    </div>
                                    
                                    {gameStatus !== 'playing' && (
                                        <div className="absolute inset-0 flex flex-col items-center justify-center bg-white/95 backdrop-blur-md rounded-xl">
                                            <h3 className="text-4xl font-black text-slate-900 mb-4">
                                                {winner === 'DRAW' ? "It's a Draw!" : `${winner} Wins!`}
                                            </h3>
                                            <button 
                                                onClick={resetGame}
                                                className="px-8 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-full font-bold shadow-lg hover:shadow-xl hover:scale-105 transition-all flex items-center gap-2"
                                            >
                                                <RotateCcw /> Play Again
                                            </button>
                                        </div>
                                    )}
                                </div>

                                {/* Stats */}
                                <div className="grid grid-cols-4 gap-3 mt-8 max-w-md mx-auto">
                                    <div className="flex flex-col items-center p-4 bg-blue-50 rounded-xl">
                                        <span className="text-3xl font-black text-blue-600">{stats.wins}</span>
                                        <span className="text-xs uppercase tracking-widest text-blue-700 font-bold">Wins</span>
                                    </div>
                                    <div className="flex flex-col items-center p-4 bg-slate-50 rounded-xl">
                                        <span className="text-3xl font-black text-slate-600">{stats.draws}</span>
                                        <span className="text-xs uppercase tracking-widest text-slate-700 font-bold">Draws</span>
                                    </div>
                                    <div className="flex flex-col items-center p-4 bg-rose-50 rounded-xl">
                                        <span className="text-3xl font-black text-rose-600">{stats.losses}</span>
                                        <span className="text-xs uppercase tracking-widest text-rose-700 font-bold">Losses</span>
                                    </div>
                                    <div className="flex flex-col items-center p-4 bg-purple-50 rounded-xl">
                                        <span className="text-3xl font-black text-purple-600">{stats.totalGames}</span>
                                        <span className="text-xs uppercase tracking-widest text-purple-700 font-bold">Total</span>
                                    </div>
                                </div>

                                {stats.totalGames > 0 && (
                                    <div className="mt-6 max-w-md mx-auto bg-slate-50 p-4 rounded-xl">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-sm font-bold text-slate-700 flex items-center gap-2">
                                                <BarChart /> Performance
                                            </span>
                                            <span className="text-2xl font-black text-blue-600">{winRate}%</span>
                                        </div>
                                        <div className="flex gap-1 h-3 rounded-full overflow-hidden bg-slate-200">
                                            <div className="bg-blue-500 transition-all" style={{ width: `${(stats.wins / stats.totalGames) * 100}%` }} />
                                            <div className="bg-slate-400 transition-all" style={{ width: `${(stats.draws / stats.totalGames) * 100}%` }} />
                                            <div className="bg-rose-500 transition-all" style={{ width: `${(stats.losses / stats.totalGames) * 100}%` }} />
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Control Panel */}
                            <div className="bg-white rounded-2xl shadow-xl p-6 border border-slate-200">
                                {/* Training */}
                                <div className="mb-6">
                                    <div className="flex items-center gap-2 mb-4 pb-3 border-b-2 border-purple-100">
                                        <div className="p-2 bg-purple-100 rounded-lg">
                                            <Brain />
                                        </div>
                                        <h3 className="font-bold text-lg">Agent Brain</h3>
                                    </div>
                                    
                                    <div className="bg-purple-50 p-4 rounded-xl border border-purple-200">
                                        <div className="text-center mb-3">
                                            <div className="text-xs text-purple-700 font-bold uppercase">Episodes</div>
                                            <div className="text-2xl font-black text-purple-700">{trainingEpisodes.toLocaleString()}</div>
                                        </div>
                                        <button 
                                            onClick={trainAgent}
                                            disabled={isTraining}
                                            className="w-full py-3 bg-purple-600 text-white rounded-lg font-bold shadow-lg hover:bg-purple-700 disabled:opacity-50 flex items-center justify-center gap-2"
                                        >
                                            {isTraining ? 'Training...' : (<><Zap /> Train 1,000</>)}
                                        </button>
                                    </div>
                                </div>

                                {/* Parameters */}
                                <div className="mb-6">
                                    <div className="flex items-center gap-2 mb-4 pb-3 border-b-2 border-indigo-100">
                                        <div className="p-2 bg-indigo-100 rounded-lg">
                                            <Settings />
                                        </div>
                                        <h3 className="font-bold text-lg">Parameters</h3>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        <div className="bg-slate-50 p-3 rounded-xl">
                                            <div className="flex justify-between text-sm mb-2">
                                                <span className="font-semibold">Learning Rate (α)</span>
                                                <span className="font-mono text-indigo-600 font-bold">{learningRate.toFixed(2)}</span>
                                            </div>
                                            <input 
                                                type="range" min="0.01" max="1" step="0.05"
                                                value={learningRate}
                                                onChange={(e) => setLearningRate(parseFloat(e.target.value))}
                                                className="w-full"
                                            />
                                        </div>

                                        <div className="bg-slate-50 p-3 rounded-xl">
                                            <div className="flex justify-between text-sm mb-2">
                                                <span className="font-semibold">Exploration (ε)</span>
                                                <span className="font-mono text-indigo-600 font-bold">{epsilon.toFixed(2)}</span>
                                            </div>
                                            <input 
                                                type="range" min="0" max="1" step="0.05"
                                                value={epsilon}
                                                onChange={(e) => setEpsilon(parseFloat(e.target.value))}
                                                className="w-full"
                                            />
                                        </div>
                                    </div>
                                </div>

                                {/* Options */}
                                <div className="space-y-3">
                                    <label className="flex items-center justify-between p-3 bg-slate-50 rounded-xl cursor-pointer">
                                        <span className="text-sm font-semibold">Show Q-Values</span>
                                        <input 
                                            type="checkbox" 
                                            checked={showQValues}
                                            onChange={() => setShowQValues(!showQValues)}
                                            className="w-4 h-4"
                                        />
                                    </label>
                                </div>

                                {/* Info */}
                                <div className="mt-6 bg-blue-50 p-4 rounded-xl border border-blue-200">
                                    <div className="flex items-start gap-3">
                                        <div className="p-2 bg-blue-100 rounded-lg">
                                            <Info />
                                        </div>
                                        <div className="text-xs text-blue-900">
                                            <p className="font-semibold mb-1">Q-Learning</p>
                                            <p className="text-blue-700">The agent learns by exploring moves and updating value estimates based on rewards.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TicTacToe />);
    </script>
</body>
</html>
